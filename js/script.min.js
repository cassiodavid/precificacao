function switchTab(e){activeTab=e;const t=document.getElementById("tabProduct"),a=document.getElementById("tabService"),o=document.getElementById("tabHourly"),s=document.getElementById("tabWorkload"),d=document.getElementById("pricingTool"),l=document.getElementById("hourlyTool"),n=document.getElementById("workloadTool"),r="flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 font-medium transition-all text-slate-600 hover:bg-slate-50",u="flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 font-medium transition-all bg-blue-600 text-white shadow-md",i="flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 font-medium transition-all bg-purple-600 text-white shadow-md",c="flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 font-medium transition-all bg-emerald-600 text-white shadow-md",m="flex-1 py-3 px-4 rounded-lg flex items-center justify-center gap-2 font-medium transition-all bg-slate-800 text-white shadow-md";t.className=r,a.className=r,o.className=r,s.className=r,d.classList.add("hidden"),l.classList.add("hidden"),n.classList.add("hidden"),"hourly"===e?(o.className=c,l.classList.remove("hidden"),calculateHourly()):"workload"===e?(s.className=m,n.classList.remove("hidden"),calculateWorkload()):(d.classList.remove("hidden"),"product"===e?(t.className=u,document.getElementById("productInputs").classList.remove("hidden"),document.getElementById("serviceInputs").classList.add("hidden"),document.getElementById("inputTitle").textContent="Custos do Produto"):(a.className=i,document.getElementById("serviceInputs").classList.remove("hidden"),document.getElementById("productInputs").classList.add("hidden"),document.getElementById("inputTitle").textContent="Custos do Serviço"),calculatePricing())}function calculatePricing(){let e=0,t=0,a=0,o="Custos",s="bg-red-500";if("product"===activeTab){const d=parseFloat(document.getElementById("prodCost").value)||0,l=parseFloat(document.getElementById("prodExpenses").value)||0;t=parseFloat(document.getElementById("prodTax").value)||0,a=parseFloat(document.getElementById("prodProfit").value)||0,e=d+l,o="Custos",s="bg-red-500"}else if("service"===activeTab){const d=parseFloat(document.getElementById("servRate").value)||0,l=parseFloat(document.getElementById("servHours").value)||0,n=parseFloat(document.getElementById("servMaterials").value)||0;t=parseFloat(document.getElementById("servTax").value)||0,a=parseFloat(document.getElementById("servProfit").value)||0,e=d*l+n,o="Mão de Obra + Custos",s="bg-blue-500"}const d=t+a;if(d>=100)return document.getElementById("errorState").classList.remove("hidden"),void document.getElementById("successState").classList.add("hidden");document.getElementById("errorState").classList.add("hidden"),document.getElementById("successState").classList.remove("hidden");const l=(100-d)/100,n=e/l,r=n*(t/100),u=n*(a/100),i=e=>e.toLocaleString("pt-PT",{minimumFractionDigits:2,maximumFractionDigits:2});document.getElementById("finalPriceDisplay").textContent=i(n),document.getElementById("profitReal").textContent="R$ "+i(u),document.getElementById("costTotal").textContent="R$ "+i(e),document.getElementById("labelCost").textContent=o,document.getElementById("valCost").textContent="R$ "+i(e),document.getElementById("barCost").style.width=e/n*100+"%",document.getElementById("barCost").className=`h-2 rounded-full transition-all duration-500 ${s}`,document.getElementById("valTax").textContent="R$ "+i(r),document.getElementById("barTax").style.width=r/n*100+"%",document.getElementById("valProfit").textContent="R$ "+i(u),document.getElementById("barProfit").style.width=u/n*100+"%"}function calculateHourly(){const e=parseFloat(hourlyInputs.desiredSalary.value)||0,t=parseFloat(hourlyInputs.fixedCosts.value)||0,a=parseFloat(hourlyInputs.taxesAndBuffer.value)||0,o=parseFloat(hourlyInputs.workDaysPerWeek.value),s=parseFloat(hourlyInputs.hoursPerDay.value),d=parseFloat(hourlyInputs.vacationWeeks.value),l=parseFloat(hourlyInputs.productivity.value);document.getElementById("displayVacation").textContent=d;const n=document.getElementById("badgeProductivity");n.textContent=l+"% Faturável",n.className=`text-xs px-2 py-0.5 rounded ${l>80?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`;const r=52,u=r-d,i=u*o,c=i*s,m=c*(l/100),y=m/12,g=e+t,p=a/100,I=p>=1?.99:p,x=g/(1-I),B=y>0?x/y:0;document.getElementById("resultHourlyRate").textContent=Math.floor(B).toLocaleString("pt-PT"),document.getElementById("resultHourlyDecimal").textContent=","+(B%1).toFixed(2).substring(2),document.getElementById("resultGrossRevenue").textContent=Math.round(x).toLocaleString("pt-PT"),document.getElementById("resultBillableHours").textContent=Math.round(y);const E=x>0?e/x*100:0,h=x>0?t/x*100:0,b=x>0?(x-g)/x*100:0;document.getElementById("percentSalary").textContent=Math.round(E)+"%",document.getElementById("barSalary").style.width=E+"%",document.getElementById("percentCosts").textContent=Math.round(h)+"%",document.getElementById("barCosts").style.width=h+"%",document.getElementById("percentTax").textContent=Math.round(b)+"%",document.getElementById("barTax").style.width=b+"%",document.getElementById("suggestedRate").textContent=`R$${Math.round(1.3*B)} - R$${Math.round(1.5*B)}`}function formatHours(e){if(isNaN(e))return"0h 00m";const t=Math.floor(e),a=Math.round(60*(e-t));return`${t}h ${a<10?"0":""}${a}m`}function calculateWorkload(){const e=parseFloat(workloadInputs.target.value),t=parseFloat(workloadInputs.costs.value)||0,a=parseFloat(workloadInputs.tax.value)||0,o=parseFloat(workloadInputs.rate.value)||1,s=parseFloat(workloadInputs.prod.value),d=parseFloat(workloadInputs.days.value);workloadDisplays.target.textContent=e,workloadDisplays.textTarget.textContent=e,workloadDisplays.rate.textContent=o,workloadDisplays.textRate.textContent=o,workloadDisplays.days.textContent=d,workloadDisplays.badgeProd.textContent=`${s}% Focada`,workloadDisplays.badgeProd.className=`text-xs px-2 py-0.5 rounded ${s<60?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`;const l=e+t,n=1-a/100,r=l/(n>0?n:1),u=r/o,i=4.33*d,c=u/i,m=s/100,y=c/(m>0?m:1),g=y-c;workloadDisplays.totalHours.textContent=formatHours(y),workloadDisplays.billableHours.textContent=formatHours(c),workloadDisplays.adminHours.textContent=formatHours(g);const p=y>24;if(p)workloadDisplays.resultContainer.classList.add("hidden"),workloadDisplays.impossibleState.classList.remove("hidden"),workloadDisplays.cardResult.className="rounded-2xl shadow-sm border p-8 transition-colors bg-red-50 border-red-200",workloadDisplays.warningMsg.classList.add("hidden"),workloadDisplays.successMsg.classList.add("hidden");else{workloadDisplays.resultContainer.classList.remove("hidden"),workloadDisplays.impossibleState.classList.add("hidden");let e="",t="";y<=6?(e="bg-emerald-50 border-emerald-200",t="text-emerald-500",workloadDisplays.successMsg.classList.remove("hidden"),workloadDisplays.warningMsg.classList.add("hidden")):y<=9?(e="bg-blue-50 border-blue-200",t="text-yellow-500",workloadDisplays.successMsg.classList.add("hidden"),workloadDisplays.warningMsg.classList.add("hidden")):y<=12?(e="bg-yellow-50 border-yellow-200",t="text-yellow-500",workloadDisplays.successMsg.classList.add("hidden"),workloadDisplays.warningMsg.classList.remove("hidden")):(e="bg-red-50 border-red-200",t="text-red-500",workloadDisplays.successMsg.classList.add("hidden"),workloadDisplays.warningMsg.classList.remove("hidden")),workloadDisplays.cardResult.className=`rounded-2xl shadow-sm border p-8 transition-colors ${e}`,workloadDisplays.circleProgress.setAttribute("class",`transition-all duration-500 ease-out ${t}`);const a=552.92,o=a*(1-Math.min(y,24)/24);workloadDisplays.circleProgress.style.strokeDashoffset=o;const s=Math.min(c/12*100,100),d=Math.min(g/12*100,100-s);workloadDisplays.barBillable.style.width=`${s}%`,workloadDisplays.barBillable.textContent=s>10?"Faturável":"",workloadDisplays.barAdmin.style.width=`${d}%`,workloadDisplays.barAdmin.textContent=d>10?"Admin":""}}lucide.createIcons();let activeTab="product";const hourlyInputs={desiredSalary:document.getElementById("desiredSalary"),fixedCosts:document.getElementById("fixedCosts"),taxesAndBuffer:document.getElementById("taxesAndBuffer"),workDaysPerWeek:document.getElementById("workDaysPerWeek"),hoursPerDay:document.getElementById("hoursPerDay"),vacationWeeks:document.getElementById("vacationWeeks"),productivity:document.getElementById("productivity")},workloadInputs={target:document.getElementById("input-target"),costs:document.getElementById("input-costs"),tax:document.getElementById("input-tax"),rate:document.getElementById("input-rate"),prod:document.getElementById("input-prod"),days:document.getElementById("input-days")},workloadDisplays={target:document.getElementById("display-target"),textTarget:document.getElementById("text-target"),rate:document.getElementById("display-rate"),textRate:document.getElementById("text-rate"),days:document.getElementById("display-days"),badgeProd:document.getElementById("badge-prod"),totalHours:document.getElementById("total-hours"),billableHours:document.getElementById("billable-hours"),adminHours:document.getElementById("admin-hours"),circleProgress:document.getElementById("circle-progress"),cardResult:document.getElementById("card-result"),resultContainer:document.getElementById("result-container"),impossibleState:document.getElementById("impossible-state"),warningMsg:document.getElementById("warning-msg"),successMsg:document.getElementById("success-msg"),barBillable:document.getElementById("bar-billable"),barAdmin:document.getElementById("bar-admin")},pricingInputs=document.querySelectorAll("#pricingTool input");pricingInputs.forEach(e=>e.addEventListener("input",calculatePricing)),Object.values(hourlyInputs).forEach(e=>e.addEventListener("input",calculateHourly)),Object.values(workloadInputs).forEach(e=>e.addEventListener("input",calculateWorkload)),calculatePricing(),calculateHourly(),calculateWorkload();